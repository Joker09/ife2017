<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		* {
			box-sizing: border-box;
		}
		
		.wrap {
			display: inline-block;
			position: relative;
			left: 50%;
			transform: translateX(-50%);
		}

		table {
			border-collapse: collapse;
			
			user-select: none;
		}
		td {
			width: 40px;
			height: 40px;
			border: 1px solid #ccc;
			text-align: center;
			font-size: 12px;
			color: #ccc;
		}

		table tr:first-child td:not(:first-child){
			border-bottom-color: #000;
			color: #000;
		}

		table tr:last-child td:not(:first-child) {
			border-bottom-color: #000;
		}
		table tr:not(:first-child) td:last-child {
			border-right-color: #000;
		}
		table tr:not(:first-child) td:first-child {
			border-right-color: #000;
			color: #000;
		}

		.box {
			width: 40px;
			height: 40px;
			background-color: red;
			position: absolute;
			z-index: 1;
			top: 40px;
			left: 40px;
			transition: all .3s ease-out;
		}

		.box::before {
			content: '';
			display: block;
			position: absolute;
			width: 100%;
			height: 10px;
			top: 0;
			left: 0;
			background-color: #000;
		}

		.act {
			text-align: center;
			margin-top: 20px;
		}

		.code {
			outline: none;
			height: 24px;
			border: none;
			background-color: #272822;
			color: #66d9ef;
			font-weight: 700;
			padding-left: 10px;
		}
	</style>
</head>
<body>
	<div class="wrap">
		<table>
			<tr>
				<td></td>
				<td>1</td>
				<td>2</td>
				<td>3</td>
				<td>4</td>
				<td>5</td>
				<td>6</td>
				<td>7</td>
				<td>8</td>
				<td>9</td>
				<td>10</td>
			</tr>
			<tr>
				<td>1</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>2</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>3</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>4</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>5</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>6</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>7</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>8</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>9</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			<tr>
				<td>10</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		</table>
		<div class="box animated"></div>
	</div>
	<div class="act">
		<input type="text" class="code">
		<button class="run">Run</button>
	</div>
	<div class="tips">
		<ul>
			<li>GO：向黑色边所面向的方向前进一格（一格等同于正方形的边长）</li>
			<li>TUN LEF：向左转（逆时针旋转90度）</li>
			<li>TUN RIG：向右转（顺时针旋转90度）</li>
			<li>TUN BAC：向右转（旋转180度）</li>
		</ul>
	</div>	
	<script>
		(function() {
			// util
			function hasClass(ele, className){
				return [].includes.call(ele.classList, className);
			}

			function addClass(ele, className) {
				if(!hasClass(ele, className)) {
					ele.className = ele.className + ' ' + className;
				}
			}

			function removeClass(ele, className) {
				if(hasClass(ele, className)) {
					ele.className = ele.className.replace(className, '').trim();
				}
			}

			var run = document.querySelector('.run'),
			    box = document.querySelector('.box');
					box.pos = {
						x: 1,
						y: 1
					};
			// 方向 
			// 0 表示向上
		    // 1 表示向右
				// 2 表示向下
				// 3 表示向左
				// 默认方向为向上
			var currentDirection = 0,
				currentTranformRatio = 0;

			// 生成坐标
			// var row = document.querySelectorAll('tr');
			// for(var i = 1; i < row.length; i++){
			// 	var col = row[i].querySelectorAll('td');
			// 	for(var j = 1; j < col.length; j++){
			// 		col[j]['data-x'] = j;
			// 		col[j]['data-y'] = i;
			// 	}
			// }

			// 改变方向
			// direction 向左 -1
			//           向右 +1
			//           调头 +2
			function changeDirection(box, direction) {
				// 如果还在动画中，则退出
				if(!hasClass(box, 'animated')){
					return;
				}

				currentDirection = currentDirection + direction;
				if(currentDirection > 3){
					currentDirection = 0;
				}
				if(currentDirection < 0) {
					currentDirection = 3;
				}
				currentTranformRatio = currentTranformRatio+direction;


				// 新的动画，移除'animated' 
				removeClass(box, 'animated');
				// 目标
				box.style.transform = 'rotate('+(90*currentTranformRatio) + 'deg)';
				// 动画结束， 添加'animated'
				(function(){
					setTimeout(function() {
						addClass(box, 'animated');
						run.disabled = false;
					},300);
				})();
			}
			
			// 移动
			function move(box) {
				var posX = box.pos.x, posY = box.pos.y;
				// var currentPos =  {x: posX, y: posY };
				// var targetPos = {};
				if (currentDirection === 0){
					box.pos = {x: posX, y: posY - 1}
				}
				if (currentDirection === 1){
					box.pos = {x: posX + 1, y: posY}
				}
				if (currentDirection === 2){
					box.pos = {x: posX, y: posY + 1}
				}
				if (currentDirection === 3){
					box.pos = {x: posX - 1, y: posY}
				}
				
				if(box.pos.x > 10 || box.pos.x < 1 || box.pos.y > 10 || box.pos.y < 1){
					alert('超出范围');
					run.disabled = false;
					return;
				}
				box.style.left = box.pos.x * 40 + 'px';
				box.style.top = box.pos.y * 40 + 'px';
			}

			function init() {
				document.querySelector('.code').focus();
				run.onclick = function() {
					var code = document.querySelector('.code').value;
					switch(code) {
						case 'GO':
						move(box);
						break;
						case 'TUN LEF':
						changeDirection(box, -1);
						break;
						case 'TUN RIG':
						changeDirection(box, 1);
						break;
						case 'TUN BAC':
						changeDirection(box, 2);
						break;
						default:
						alert("指令错误");
					}
				}
			}

			init();
		})();
	</script>
</body>
</html>